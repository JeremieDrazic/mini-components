"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),defineProperty=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},get=function e(t,n,o){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,o)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(o):void 0},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},Observer=function(){function e(t){classCallCheck(this,e),this.observer=new MutationObserver(this.update.bind(this)),this.observer.observe(t,{childList:!0,subtree:!0}),this.listeners=[]}return createClass(e,[{key:"on",value:function(e){this.listeners.push(e)}},{key:"off",value:function(e){this.listeners.splice(this.listeners.indexOf(e),1)}},{key:"update",value:function(e){this.listeners.forEach(function(e){try{e()}catch(e){console.error(e)}})}},{key:"kill",value:function(){this.observer.disconnect()}}]),e}(),idCounter={};function uniqId(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"$tree-";idCounter[e]||(idCounter[e]=0);var t=++idCounter[e];return"$tree-"===e?""+t:""+(e+t)}function forEach(e,t){if(!e)return[];"object"===(void 0===e?"undefined":_typeof(e))&&"length"in e||(e=[e]);for(var n=e.length,o=0;o<n;o++)t(e[o],o);return e}function forIn(e,t){if("object"===(void 0===e?"undefined":_typeof(e)))return forEach(Object.keys(e),forKey.bind(null,e,t)),e}function forKey(e,t,n){t(n,e[n])}function _isDOMElement(e){return!!e&&1===e.nodeType}function _getElement(e,t){return e.querySelector(t)}function getElement(e){return"string"==typeof e?_getElement(document,e):e instanceof window.NodeList||e instanceof window.HTMLCollection?e[0]:e instanceof Array?getElement(e[0]):_isDOMElement(e)&&e}function copyPropertyAccessor(e,t,n){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}var arrayReactiveMethods=["push","splice","unshift"];function makeReactive$1(e,t,n){Object.defineProperty(e,t,{get:function(){return n},set:function(e){n=e,"object"===(void 0===e?"undefined":_typeof(e))&&forIn(e,makeReactive()),n instanceof Array&&forEach(arrayReactiveMethods,function(e){n[e]=function(){return Array.prototype[e].apply(this,arguments)}})}}),e[t]=n}var lifeCycleMethods=["mounted","beforeDestroy"],Component=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};classCallCheck(this,e),Object.assign(this,t),this.$options=n,this.$id=this._generateComponentId(),this.$scope={},this._bindData(),this._bindLifeCycle(),this._bindMethods()}return createClass(e,[{key:"_generateComponentId",value:function(){return uniqId(""+this.$prefix+this.$options.name+"-")}},{key:"_bindData",value:function(){var e=this;this.$data={},forIn(this.$options.data,function(t,n){makeReactive$1(e.$data,t,n),copyPropertyAccessor(t,e,e.$data),copyPropertyAccessor(t,e.$scope,e.$data)})}},{key:"_bindLifeCycle",value:function(){var e=this;forEach(lifeCycleMethods,function(t){e[t]=function(){for(var n=arguments.length,o=Array(n),r=0;r<n;r++)o[r]=arguments[r];forEach(e.$options[t],function(t){return t.apply(e,o)})}})}},{key:"_bindMethods",value:function(){var e=this;this.$methods={},forIn(this.$options.methods,function(t,n){e.$methods[t]=n.bind(e)}),Object.assign(this,this.$methods),Object.assign(this.$scope,this.$methods)}},{key:"$mount",value:function(e){this.$el=getElement(e),this.$el[this.$marker]=this.$id;try{this.mounted(e)}catch(e){console.error(e)}}},{key:"$destroy",value:function(){try{this.beforeDestroy()}catch(e){console.error(e)}}}]),e}();function kebabCase(e){return e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}function closest(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;return!(!(e=getElement(e))||("string"==typeof n?e.matches(n):e===n))&&(("string"==typeof t?e.matches(t):e===t)?e:!!e&&closest(e.parentNode,t,n))}function _nodeListToArray(e){for(var t=[],n=-1;t[++n]=e[n];);return t.length--,t}function _getElements(e,t){return _nodeListToArray(e.querySelectorAll(t))}function getElements(e){if("string"==typeof e)return _getElements(document,e);if(e instanceof window.NodeList||e instanceof window.HTMLCollection)return _nodeListToArray(e);if(e instanceof Array){var t=[];return forEach(e,_pushRecursive.bind(null,t)),t}return _isDOMElement(e)?[e]:[]}function _pushRecursive(e,t){e.push.apply(e,getElements(t))}function forElements(e,t){forEach(getElements(e),t)}function _applyOnElements(e,t,n){var o=[];return forElements(t,e.bind(null,o,n)),o}var find=_applyOnElements.bind(null,_findFromOne);function _findFromOne(e,t,n){e.push.apply(e,_getElements(n,t))}var defaultGlobals={$prefix:"wh-"},defaultOptions={name:"root"},Whale=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};classCallCheck(this,t),e=_extends({},defaultGlobals,e),n=_extends({},defaultOptions,n);var o=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.$components=defineProperty({},o.$id,o),o.$globals=_extends({},e,n,{$root:o,$components:o.$components}),o.$globals.$marker=o.$marker="_"+o.$prefix+"id",o._components=[],o}return inherits(t,Component),createClass(t,[{key:"component",value:function(e,t){e=kebabCase(e),console.log(e);var n="selector"in t?t.selector:"["+this.$prefix+"id]";this._components.push({selector:n,options:_extends({name:e,selector:n},t)})}},{key:"$mount",value:function(e){get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"$mount",this).call(this,e),this._observer=new Observer(this.$el),this._observer.on(this._domChanged.bind(this)),this._domChanged()}},{key:"_domChanged",value:function(){this._unbindComponents(),this._bindComponents()}},{key:"_unbindComponents",value:function(){forIn(this.$components,function(e,t){closest(t.$el,document.body)||(t.$destroy(),delete t[e])})}},{key:"_bindComponents",value:function(){var e=this;forEach(this._components,function(t){forEach(find(e.$el,t.selector),function(n){if(!(e.$marker in n)){var o=new Component(e.$globals,t.options);o.$mount(n),e.$components[o.$id]=o}})})}}]),t}();function get$1(e,t){var n=t.split(".");t=n.pop();for(var o=n.length,r=0;r<o;++r)e=e[n[r]];return e[t]}function set$1(e,t,n){var o=t.split(".");t=o.pop();for(var r=o.length,i=0;i<r;++i)e=e[o[i]];return e[t]=n}var Whale$1=Object.assign(Whale,{get:get$1,set:set$1});module.exports=Whale$1;
