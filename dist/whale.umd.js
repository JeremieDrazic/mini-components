!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Whale=e()}(this,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),o=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},s=function(){function t(n){e(this,t),this.observer=new MutationObserver(this.update.bind(this)),this.observer.observe(n,{childList:!0,subtree:!0}),this.listeners=[]}return n(t,[{key:"on",value:function(t){this.listeners.push(t)}},{key:"off",value:function(t){this.listeners.splice(this.listeners.indexOf(t),1)}},{key:"update",value:function(t){this.listeners.forEach(function(t){try{t()}catch(t){console.error(t)}})}},{key:"kill",value:function(){this.observer.disconnect()}}]),t}(),u={};function c(e,n){if(!e)return[];"object"===(void 0===e?"undefined":t(e))&&"length"in e||(e=[e]);for(var o=e.length,i=0;i<o;i++)n(e[i],i);return e}function a(e,n){if("object"===(void 0===e?"undefined":t(e)))return c(Object.keys(e),function(t,e,n){e(n,t[n])}.bind(null,e,n)),e}function f(t){return!!t&&1===t.nodeType}function l(t){return"string"==typeof t?(e=document,n=t,e.querySelector(n)):t instanceof window.NodeList||t instanceof window.HTMLCollection?t[0]:t instanceof Array?l(t[0]):f(t)&&t;var e,n}function p(t,e,n){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}var h=["push","splice","unshift"];var d=["mounted","beforeDestroy"],y=function(){function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,o),Object.assign(this,t),this.$options=n,this.$id=this._generateComponentId(),this.$scope={},this._bindData(),this._bindLifeCycle(),this._bindMethods()}return n(o,[{key:"_generateComponentId",value:function(){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"$tree-";u[t]||(u[t]=0);var e=++u[t];return"$tree-"===t?""+e:""+(t+e)}(""+this.$prefix+this.$options.name+"-")}},{key:"_bindData",value:function(){var e=this;this.$data={},a(this.$options.data,function(n,o){!function(e,n,o){Object.defineProperty(e,n,{get:function(){return o},set:function(e){o=e,"object"===(void 0===e?"undefined":t(e))&&a(e,makeReactive()),o instanceof Array&&c(h,function(t){o[t]=function(){return Array.prototype[t].apply(this,arguments)}})}}),e[n]=o}(e.$data,n,o),p(n,e,e.$data),p(n,e.$scope,e.$data)})}},{key:"_bindLifeCycle",value:function(){var t=this;c(d,function(e){t[e]=function(){for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];c(t.$options[e],function(e){return e.apply(t,o)})}})}},{key:"_bindMethods",value:function(){var t=this;this.$methods={},a(this.$options.methods,function(e,n){t.$methods[e]=n.bind(t)}),Object.assign(this,this.$methods),Object.assign(this.$scope,this.$methods)}},{key:"$mount",value:function(t){this.$el=l(t),this.$el[this.$marker]=this.$id;try{this.mounted(t)}catch(t){console.error(t)}}},{key:"$destroy",value:function(){try{this.beforeDestroy()}catch(t){console.error(t)}}}]),o}();function v(t){for(var e=[],n=-1;e[++n]=t[n];);return e.length--,e}function b(t,e){return v(t.querySelectorAll(e))}function m(t){if("string"==typeof t)return b(document,t);if(t instanceof window.NodeList||t instanceof window.HTMLCollection)return v(t);if(t instanceof Array){var e=[];return c(t,function(t,e){t.push.apply(t,m(e))}.bind(null,e)),e}return f(t)?[t]:[]}var $=function(t,e,n){var o=[];return function(t,e){c(m(t),e)}(e,t.bind(null,o,n)),o}.bind(null,function(t,e,n){t.push.apply(t,b(n,e))});var g={$prefix:"wh-"},_={name:"root"},O=function(t){function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,u),t=i({},g,t),n=i({},_,n);var s=r(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,t,n));return s.$components=o({},s.$id,s),s.$globals=i({},t,n,{$root:s,$components:s.$components}),s.$globals.$marker=s.$marker="_"+s.$prefix+"id",s._components=[],s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(u,y),n(u,[{key:"component",value:function(t,e){t=t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),console.log(t);var n="selector"in e?e.selector:"["+this.$prefix+"id]";this._components.push({selector:n,options:i({name:t,selector:n},e)})}},{key:"$mount",value:function(t){(function t(e,n,o){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,o)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(o):void 0})(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"$mount",this).call(this,t),this._observer=new s(this.$el),this._observer.on(this._domChanged.bind(this)),this._domChanged()}},{key:"_domChanged",value:function(){this._unbindComponents(),this._bindComponents()}},{key:"_unbindComponents",value:function(){a(this.$components,function(t,e){(function t(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;return!(!(e=l(e))||("string"==typeof o?e.matches(o):e===o))&&(("string"==typeof n?e.matches(n):e===n)?e:!!e&&t(e.parentNode,n,o))})(e.$el,document.body)||(e.$destroy(),delete e[t])})}},{key:"_bindComponents",value:function(){var t=this;c(this._components,function(e){c($(t.$el,e.selector),function(n){if(!(t.$marker in n)){var o=new y(t.$globals,e.options);o.$mount(n),t.$components[o.$id]=o}})})}}]),u}();return Object.assign(O,{get:function(t,e){var n=e.split(".");e=n.pop();for(var o=n.length,i=0;i<o;++i)t=t[n[i]];return t[e]},set:function(t,e,n){var o=e.split(".");e=o.pop();for(var i=o.length,r=0;r<i;++r)t=t[o[r]];return t[e]=n}})});
